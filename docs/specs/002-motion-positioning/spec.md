# 기능 사양서: Motion & Positioning (주행 및 위치 제어)

**기능 브랜치**: `002-motion-positioning`
**생성일**: 2025-11-03
**상태**: 초안
**입력**: 사용자 설명: "2.1. Motion & Positioning (주행 및 위치 제어)..."

## 사용자 시나리오 및 테스트 *(필수)*

### 사용자 스토리 1 - S-Curve Motion Profile을 이용한 부드러운 주행 (우선순위: P1)

운영자는 로봇이 S-Curve Motion Profile을 사용하여 부드럽게 가감속하며, GUI를 통해 프로파일 파라미터를 동적으로 설정할 수 있어야 합니다.

**이 우선순위인 이유**: 로봇의 안정적인 주행과 화물의 안전을 보장하는 핵심 기능입니다.

**독립 테스트**: 시뮬레이션 및 실제 환경에서 로봇의 가감속 프로파일을 추적하고, GUI를 통해 파라미터를 변경하여 즉시 적용되는지 확인할 수 있습니다.

**인수 시나리오**:

1.  **주어진 상황** 로봇이 정지 상태일 때, **언제** 운영자가 GUI에서 새로운 Jerk, 가속도, 속도 값을 입력하고 적용하면, **그러면** 로봇은 다음 주행부터 새로운 프로파일 파라미터를 사용하여 이동해야 합니다.

---

### 사용자 스토리 2 - 센서 퓨전을 통한 정확한 위치 보정 (우선순위: P1)

로봇은 Odometry와 절대 위치 센서(RFID, QR 등) 데이터를 융합하여 $\pm$ 5mm의 높은 정밀도로 자신의 위치를 인식해야 합니다.

**이 우선순위인 이유**: 정확한 위치 인식은 모든 자율 주행 및 임무 수행의 기본입니다.

**독립 테스트**: 알려진 위치에 태그를 배치하고, 로봇이 해당 위치를 여러 번 지나가게 하여 위치 추정의 정확성과 반복성을 검증할 수 있습니다.

**인수 시나리오**:

1.  **주어진 상황** 로봇이 주행 중일 때, **언제** 외부 태그 인식에 실패하면, **그러면** 로봇은 Dead Reckoning 모드로 자동 전환하고, 위치 오차가 $\pm 20$ mm를 초과하면 Critical 알람을 발생시켜야 합니다.
2.  **주어진 상황** 로봇이 목표 위치 100m 이내에 있을 때, **언제** 정밀 보정 루틴이 활성화되면, **그러면** 로봇은 위치 정밀도를 $\pm 5$ mm 이내로 확보해야 합니다.

---

### 사용자 스토리 3 - 속도 의존적인 안전 영역을 통한 충돌 방지 (우선순위: P2)

로봇은 자신의 속도에 맞춰 동적으로 안전 영역(보호 구역, 경고 구역)의 크기를 조절하고, 영역 침범 시 안전하게 감속 또는 정지해야 합니다.

**이 우선순위인 이유**: 고속 주행 시에도 작업자와 주변 환경의 안전을 보장하기 위함입니다.

**독립 테스트**: 다양한 속도로 주행하는 로봇 앞에 가상 또는 실제 장애물을 배치하여, 속도에 따라 안전 영역이 변경되고 로봇이 적절히 반응하는지 테스트할 수 있습니다.

**인수 시나리오**:

1.  **주어진 상황** 로봇이 고속으로 주행 중일 때, **언제** 장애물이 경고 구역에 진입하면, **그러면** 시스템은 AVOID_INFO 메시지를 DataStore에 업데이트해야 합니다.
2.  **주어진 상황** 로봇이 주행 중일 때, **언제** 장애물이 제어 정지 구역에 진입하면, **그러면** 로봇은 S-Curve 프로파일에 따라 안전하게 감속하여 정지하고, `AVOIDANCE_PAUSED` 상태로 전환해야 합니다.

---

### 엣지 케이스

- 위치 보정 태그가 손상되거나 인식할 수 없는 환경에서는 어떻게 동작합니까?
- 센서 데이터에 노이즈가 많을 경우, 위치 추정의 신뢰성을 어떻게 유지합니까?

## 요구사항 *(필수)*

### 기능적 요구사항

- **FR-001**: 시스템은 최소 2차(Jerk) S-Curve Motion Profile 제어를 구현해야 합니다.
- **FR-002**: Motion Profile 파라미터(Jerk, Accel, Velocity)는 GUI를 통해 동적으로 설정 가능해야 합니다.
- **FR-003**: 시스템은 최소 2가지 이상의 센서 데이터를 융합하여 위치 신뢰성을 확보해야 합니다.
- **FR-004**: 외부 위치 센서 인식 실패 시, 시스템은 Dead Reckoning 모드로 자동 전환되어야 합니다.
- **FR-005**: 위치 정보는 10ms 주기로 DataStore에 실시간 업데이트되어야 합니다.
- **FR-006**: 시스템은 로봇의 속도에 비례하여 안전 영역의 크기를 동적으로 조정해야 합니다.
- **FR-007**: 안전 영역 침범 시, 시스템은 S-Curve Motion Profile을 오버라이드하여 안전하게 감속 또는 정지해야 합니다.
- **FR-008**: 시스템은 RFID 태그 및 QR 코드 기반 센서 퓨전을 통해 위치를 보정해야 합니다.

### 주요 엔티티

- **MotionController**: 로봇의 주행 및 위치 제어를 담당하는 모듈입니다.
- **DataStore**: 로봇의 현재 위치, 속도, 가속도 등 동적 상태 데이터를 저장합니다.
- **Task**: 주행(DriveTo), 위치 보정(Localize) 등 Motion과 관련된 개별 작업 단위입니다.
- **SensorData**: Odometry, RFID, QR, LDS 등 위치 및 환경 인식을 위한 센서 데이터입니다.

## 성공 기준 *(필수)*

### 측정 가능한 결과

- **SC-001**: 위치 정밀도 $\pm$ 5 mm 이하를 달성해야 합니다.
- **SC-002**: 위치 정보 업데이트 주기는 10 ms를 준수해야 합니다.
- **SC-003**: 다양한 환경(먼지, 조명 변화)에서도 위치 보정 기능이 견고하게 동작해야 합니다.
- **SC-004**: 위치 보정용 태그/비콘의 설치 및 교체가 용이해야 합니다.
