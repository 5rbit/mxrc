# 기능 사양서: 디지털/아날로그 I/O 관리 (Digital/Analog I/O Management)

**기능 브랜치**: `006-io-management`
**생성일**: 2025-11-03
**상태**: 초안
**입력**: 사용자 설명: "2.5. 디지털/아날로그 I/O 관리..."

## 사용자 시나리오 및 테스트 *(필수)*

### 사용자 스토리 1 - 하드웨어로부터 I/O 로직 분리 (우선순위: P1)

개발자는 하드웨어의 물리적 접근 로직(HAL)과 제어기 로직을 완전히 분리하여, 하드웨어 변경 시 제어기 코드 수정 없이 HAL만 교체하여 대응할 수 있어야 합니다.

**이 우선순위인 이유**: 시스템의 유지보수성을 극대화하고, 특정 하드웨어에 대한 종속성을 제거합니다.

**독립 테스트**: 시뮬레이션된 HAL(Mock HAL)을 사용하여 제어기 로직의 I/O 처리 기능을 테스트하고, 실제 하드웨어 HAL로 교체했을 때도 동일하게 동작하는지 검증할 수 있습니다.

**인수 시나리오**:

1.  **주어진 상황** 특정 I/O 모듈의 하드웨어가 변경되었을 때, **언제** 개발자가 새로운 하드웨어에 맞는 HAL 드라이버만 교체하면, **그러면** 상위 제어 로직은 코드 수정 없이 새로운 하드웨어를 정상적으로 인식하고 제어해야 합니다.

---

### 사용자 스토리 2 - 외부 설정 파일을 통한 동적 I/O 구성 (우선순위: P2)

운영자는 코드 변경 없이 외부 설정 파일(JSON/YAML)을 통해 모든 I/O의 속성(타입, 지연, 필터 등)을 동적으로 정의하고 변경할 수 있어야 합니다.

**이 우선순위인 이유**: 현장 상황에 맞춰 신속하게 I/O 설정을 변경하고, 시스템의 유연성을 높입니다.

**독립 테스트**: 다양한 I/O 속성을 가진 설정 파일을 작성하고, 시스템 초기화 시 해당 설정이 정확하게 로드되어 각 I/O 채널에 적용되는지 확인할 수 있습니다.

**인수 시나리오**:

1.  **주어진 상황** 운영자가 `io_config.json` 파일에서 특정 디지털 입력의 `OnDelay` 값을 500ms로 설정했을 때, **언제** 시스템이 재시작되면, **그러면** 해당 입력 신호는 500ms 이상 지속되어야만 `ON` 상태로 인식되어야 합니다.
2.  **주어진 상황** 운영자가 설정 파일에서 아날로그 입력의 필터 종류를 `MovingAverageFilter`로 변경했을 때, **언제** 시스템이 재시작되면, **그러면** 해당 아날로그 입력 값은 이동 평균 필터가 적용된 값으로 처리되어야 합니다.

---

### 엣지 케이스

- 유효하지 않은 I/O 설정 파일(스키마 오류, 값 범위 초과)이 로드될 경우, 시스템은 어떻게 안전하게 초기화됩니까?
- I/O 모듈과의 통신이 일시적으로 끊겼다가 다시 연결될 경우, 시스템은 어떻게 상태를 복구합니까?

## 요구사항 *(필수)*

### 기능적 요구사항

- **FR-001**: 시스템은 I/O의 물리적 접근 로직과 핵심 동작 로직을 분리하는 하드웨어 추상화 계층(HAL)을 구현해야 합니다.
- **FR-002**: 모든 I/O의 정의 및 속성(Type, Delay, Filter 등)은 외부 설정 파일(JSON/YAML)을 통해 동적으로 로드되어야 합니다.
- **FR-003**: 디지털 입력은 접점 타입(A/B) 정의 및 논리적 반전 처리를 지원해야 합니다.
- **FR-004**: 디지털 입/출력은 On/Off Delay 기능을 지원하여 노이즈를 필터링해야 합니다.
- **FR-005**: 아날로그 입력은 이동 평균 필터, 저역 통과 필터 등 설정 가능한 필터링 기능을 제공해야 합니다.
- **FR-006**: 아날로그 입/출력은 물리량 변환을 위한 스케일(Scale) 및 오프셋(Offset) 설정 기능을 포함해야 합니다.

### 주요 엔티티

- **IOModule**: 모든 디지털/아날로그 I/O 신호를 관리하는 최상위 모듈입니다.
- **HAL (Hardware Abstraction Layer)**: 특정 하드웨어(e.g., EtherCAT 마스터)에 대한 물리적 접근 로직을 캡슐화합니다.
- **IOConfig**: 외부 파일(JSON/YAML)에 정의된 개별 I/O 채널의 모든 속성(타입, 지연, 필터 등)을 담는 데이터 구조체입니다.

## 성공 기준 *(필수)*

### 측정 가능한 결과

- **SC-001**: 새로운 I/O 하드웨어 모듈을 지원하기 위해 HAL을 교체하는 작업은 1일 이내에 완료되어야 합니다. (제어기 로직 수정 불필요)
- **SC-002**: 운영자는 10분 이내에 외부 설정 파일 수정을 통해 새로운 I/O 채널을 추가하고 시스템에 적용할 수 있어야 합니다.
- **SC-003**: I/O 설정 파일의 유효성 검증은 시스템 초기화 시 100ms 이내에 완료되어야 합니다.
